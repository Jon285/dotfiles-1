#!/usr/bin/env bash
# dotsetup
# 
# Personal script to update dotfiles.


# print message, remove old files/directory, and perform a symlink.
function symlink()
{
    # check if old file exists.
    # remove the old one and create a new symlink.
    if [ -e $2 ] || [ -L $2 ]; then
        rm $2
    fi

    if [ -d $2 ]; then
        rm -rf $2
    fi

    echo "[*] $2 -> $1"
    ln -s $1 $2
}

function setup_dotfiles()
{
    # X server configuration.
    symlink "$HOME/.config/dotfiles/.x" "$HOME/.x"
    symlink "$HOME/.config/dotfiles/.xinitrc" "$HOME/.xinitrc"
    symlink "$HOME/.config/dotfiles/.xserverrc" "$HOME/.xserverrc"
    symlink "$HOME/.config/dotfiles/.Xresources" "$HOME/.Xresources"
    symlink "$HOME/.config/dotfiles/.xbindkeysrc" "$HOME/.xbindkeysrc"
    
    # bash, zsh, vim, wget, curl, neofetch, ncmpcpp, git configuration.
    symlink "$HOME/.config/dotfiles/.bashrc" "$HOME/.bashrc"
    symlink "$HOME/.config/dotfiles/.zshrc" "$HOME/.zshrc"
    symlink "$HOME/.config/dotfiles/.vim" "$HOME/.vim"
    symlink "$HOME/.config/dotfiles/.vimrc" "$HOME/.vimrc"
    symlink "$HOME/.config/dotfiles/.wgetrc" "$HOME/.wgetrc"
    symlink "$HOME/.config/dotfiles/.curlrc" "$HOME/.curlrc"
    symlink "$HOME/.config/dotfiles/.config/neofetch" "$HOME/.config/neofetch"
    symlink "$HOME/.config/dotfiles/.config/ncmpcpp" "$HOME/.ncmpcpp"
    symlink "$HOME/.private/git/.gitconfig" "$HOME/.gitconfig"

    # i3, dunst, compton, menutray, KDE, gtk configuration.
    symlink "$HOME/.config/dotfiles/.config/i3" "$HOME/.config/i3"
    symlink "$HOME/.config/dotfiles/.config/i3blocks" "$HOME/.config/i3blocks"
    symlink "$HOME/.config/dotfiles/.config/i3lock" "$HOME/.config/i3lock"
    symlink "$HOME/.config/dotfiles/.config/polybar" "$HOME/.config/polybar"
    symlink "$HOME/.config/dotfiles/.config/dunst" "$HOME/.config/dunst"
    symlink "$HOME/.config/dotfiles/.config/compton" "$HOME/.config/compton"
    symlink "$HOME/.config/dotfiles/.config/menutray" "$HOME/.config/menutray"
    symlink "$HOME/.config/dotfiles/.config/plasma-workspace" "$HOME/.config/plasma-workspace"
    symlink "$HOME/.config/dotfiles/.gtkrc-2.0" "$HOME/.gtkrc-2.0"
    symlink "$HOME/.gtkrc-2.0" "$HOME/.gtkrc-2.0-kde4"
    
    # Custom command aliases and functions.
    symlink "$HOME/.config/dotfiles/.config/zsh/.aliases" "$HOME/.config/zsh/aliases"
    symlink "$HOME/.config/dotfiles/.config/zsh/.functions" "$HOME/.config/zsh/functions"
    
    # Now bin/* will be accessible under ~/.local/bin/.
    symlink "$HOME/.config/dotfiles/bin" "$HOME/.local/bin"
    symlink "$HOME/Workspaces/02-Projects/bash-displayctl/displayctl" "$HOME/.local/bin/displayctl"

    # gdb configuration.
    symlink "$HOME/.config/dotfiles/.gdbinit" "$HOME/.gdbinit"

    # Misc.
    symlink "$HOME/.config/dotfiles/res/.face.icon" "$HOME/.face.icon"

    # Copy zsh theme.
    cp -p "$HOME/.config/dotfiles/.config/oh-my-zsh/themes/coldwood.zsh-theme" "$HOME/.config/oh-my-zsh/themes/."
}


# Confirmation.
echo "dotsetup"
echo "========================================================================="
echo "Running this script without reading it might lead to devastating results."
echo "Make sure you've read the code before running it, and that you've put"
echo "these dotfiles under ~/.config/dotfiles"
echo -n "Proceed? [type yes in uppercase] "
read choice

# Check user directory existence.
if [ "$choice" = "YES" ]; then
    echo -e "Running...\n"
    setup_dotfiles
    echo -e "\n[*] Congrats! You have updated all symlinks and dotfiles are now ready to be loaded."
else
    echo "Aborted."
    exit 0
fi
